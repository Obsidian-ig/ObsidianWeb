<!DOCTYPE html>
<html>
  <head>
    <title>Loading Dashboard | ObsidianWeb!</title>
    <style>
      body {
        background-color: #8e44ad;
      }
    </style>
  </head>
  <body>
    <center>
      <div style="margin-top: 270px">
        <img src="assets/spinning-wheel-purple.webp" />
      </div>
    </center>

    <script>
      function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000); // Days to milliseconds
        const expires = "expires=" + date.toUTCString();
        document.cookie = `${name}=${value}; ${expires}; path=/`;
      }

      function getCookie(name) {
        const cookies = document.cookie.split("; ");
        for (const cookie of cookies) {
          const [key, value] = cookie.split("=");
          if (key === name) return value;
        }
        console.log("cookie not found: " + name);
        return null; // Cookie not found
      }

      window.onload = async () => {
        try {
          const response = await fetch(
            "http://localhost:3000/api/users/dashboard",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                authorization: "Bearer " + getCookie("sessionToken"),
                username: getCookie("username"),
              },
              body: JSON.stringify({}),
            }
          );

          const data = await response.json();
          if (response.ok) {
            document.documentElement.innerHTML = data.data;

            // Reinitialize particles.js
            const script = document.createElement("script");
            script.src = "particles.js"; // Ensure this path is correct
            script.onload = () => {
              particlesJS("particles-js", {
                particles: {
                  number: {
                    value: 80,
                    density: {
                      enable: true,
                      value_area: 800,
                    },
                  },
                  color: {
                    value: "#ffffff",
                  },
                  shape: {
                    type: "circle",
                    stroke: {
                      width: 0,
                      color: "#000000",
                    },
                    polygon: {
                      nb_sides: 5,
                    },
                  },
                  opacity: {
                    value: 0.5,
                    random: false,
                    anim: {
                      enable: false,
                      speed: 1,
                      opacity_min: 0.1,
                      sync: false,
                    },
                  },
                  size: {
                    value: 3,
                    random: true,
                    anim: {
                      enable: false,
                      speed: 40,
                      size_min: 0.1,
                      sync: false,
                    },
                  },
                  line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#ffffff",
                    opacity: 0.4,
                    width: 1,
                  },
                  move: {
                    enable: true,
                    speed: 6,
                    direction: "none",
                    random: false,
                    straight: false,
                    out_mode: "out",
                    bounce: false,
                    attract: {
                      enable: false,
                      rotateX: 600,
                      rotateY: 1200,
                    },
                  },
                },
                interactivity: {
                  detect_on: "canvas",
                  events: {
                    onhover: {
                      enable: true,
                      mode: "repulse",
                    },
                    onclick: {
                      enable: true,
                      mode: "push",
                    },
                    resize: true,
                  },
                  modes: {
                    grab: {
                      distance: 400,
                      line_linked: {
                        opacity: 1,
                      },
                    },
                    bubble: {
                      distance: 400,
                      size: 40,
                      duration: 2,
                      opacity: 8,
                      speed: 3,
                    },
                    repulse: {
                      distance: 100,
                      duration: 0.4,
                    },
                    push: {
                      particles_nb: 4,
                    },
                    remove: {
                      particles_nb: 2,
                    },
                  },
                },
                retina_detect: true,
              });
            };
            document.head.appendChild(script);
          }
        } catch (error) {
          console.error("Error:", error);
        }
      };
    </script>
  </body>
</html>
